---
layout: distill
title: Finite Element Limit Analysis
description: a brief introduction to limit analysis using conic optimization
tags: linear-algebra optimization conic-optimization semidefinite-programming
giscus_comments: true
date: 2025-01-01 12:00:00
featured: false
# citation: true

authors:
  - name: Mikkel Paltorp
    url: "https://mipals.github.io"
    affiliations:
      name: Technical University of Denmark

bibliography: 2025-01-01-fela.bib

# Optionally, you can add a table of contents to your post.
# NOTES:
#   - make sure that TOC names match the actual section names
#     for hyperlinks within the post to work correctly.
#   - we may want to automate TOC generation in the future using
#     jekyll-toc plugin (https://github.com/toshimaru/jekyll-toc).
toc:
  - name: Introduction

# Below is an example of injecting additional post-specific styles.
# If you use this post as a template, delete this _styles block.
_styles: >
  .fake-img {
    background: #bbb;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 0px 4px rgba(0, 0, 0, 0.1);
    margin-bottom: 12px;
  }
  .fake-img p {
    font-family: monospace;
    color: white;
    text-align: left;
    margin: 12px 0;
    text-align: center;
    font-size: 16px;
  }
---




## Introduction

In mechanical engineering we talk about elastic (reversible) and plastic (non-reversible) deformation. Finite Element Limit Analysis uses optimization to compute bounds on the plastic collapse load. Said differently: We want to find the maximum force that still results in elastic deformations. This problem can be posed a conic constrained optimization problem which can be solved efficiently using modern optimization software.

### Stress and notation
The **stress** is a quantity that describes the forces present during deformation. **This is our optimization variable**. In 2D the stresses are described by a symmetric matrix/tensor

$$
\begin{equation}\label{eq:cauchy:tensor}
        \sigma(\bx) = \begin{bmatrix}\sigma_{x} & \tau_{xy}\\ \tau_{yx} & \sigma_y\end{bmatrix}.
\end{equation}
$$

In the Finite Element Method (FEM), we work with a vectorized form of the stress that we denote using the superscript ${}^V$. Since the matrix is symmetric ($\tau_{xy} = \tau_{yx}$) we include only one of them in the vectorized form. 

$$
    \sigma^V_i = \begin{bmatrix}\sigma_x^i \\ \tau_{xy}^i \\ \sigma_y^i \end{bmatrix}.
$$

Now, on every element so-called nodes exist where the stresses are defined. If we have $n$ nodes in total, we can stack all the single vectorizations into one big vector containing all stresses in the domain. That is

$$
    \sigma^V = \begin{bmatrix}\sigma^V_1 \\ \vdots \\ \sigma^V_n\end{bmatrix}.
$$

### Discretized equilibrium equations
Equating external and internal work (and fast forwarding slightly)

$$
    \int_\Omega \left[\text{grad}(\overline{\bu})\right]^\text{sym}:\overline{\sigma}\ \mathrm{d}\Omega = \lambda \overline{\bu}^\top \bP.
$$

We can now introduce our element approximations

$$
    \overline{\bu} \approx \bN_u\bu, \quad \overline{\sigma^V} = \bN_\sigma\sigma^V,
$$

Inserting this we have that

$$
    \bu^\top\int_\Omega \left[\text{grad}(\bN_u)\right]^\text{sym}:\bN_\sigma\ \mathrm{d}\Omega\ \sigma^V \approx \lambda \bu^\top\bP
$$

This has to hold for all possible $\bu$ resulting in the equation

$$
    \int_\Omega \left[\text{grad}(\bN_u)\right]^\text{sym}:\bN_\sigma\ \mathrm{d}\Omega\ \sigma^V \approx \lambda \bP\quad \Rightarrow \quad\bB^\top\sigma^V = \lambda\bP
$$

### The Mohr-Coulomb yield surface
A yield surface defines the border between elastic and plastic deformations as a function of (the eigenvalues of the) stresses ($\sigma$). 

The Mohr-Coulomb yield surface says that elastic deformation occurs as long as

$$
    \sqrt{(\sigma_{x} - \sigma_y)^2 + (2\tau_{xy})^2} \leq -\sin(\phi)(\sigma_x + \sigma_y) + 2c\cos(\phi),
$$

where $c$ is the cohesion and $\phi$ the angle of internal friction (material parameters). 


### FELA
We are now ready to state the optimization problem as

$$
    \begin{aligned}
        \text{maximize}\quad    & \lambda\\
        \text{subject to}\quad  & \mathbf{B}^\top\sigma^V = \lambda\mathbf{P}\\
        \forall i \in 1,\dots,n_\text{nodes} \quad &
        \sqrt{(\sigma_{x}^i - \sigma_y^i)^2 + (2\tau_{xy}^i)^2} \leq -\sin(\phi)(\sigma_x^i + \sigma_y^i) + 2c\cos(\phi) \\
    \end{aligned}
$$

This problem *could* be solved by any non-linear optimization solver.

**But there is a better way: Using conic optimization!**


### (Conic) Constrained optimization
Today we aim to solve optimization problems of the form

$$
\begin{alignat*}{3}
    &\text{minimize}\quad  && q^\top x \\
    &\text{subject to} && A_ix + s_i = b_i, \\
    &\ && s_i \in \mathcal{K}_i,\ i = 1,\dots, n_\text{cones},
\end{alignat*}
$$

where $\mathcal{K}_i$ is a convex cone (i.e. $\alpha,\beta\geq0$, $x,y\in\mathcal{K}_i$ $\Rightarrow \alpha x + \beta y \in \mathcal{K}_i$).

**Linear programming** is a subset of conic optimization using the cones

* The **zero cone**: $\mathcal{Z}_n := \lbrace 0\rbrace^n$ (used to model equality constraints). 

* The **nonnegative cone**: $\mathbb{R}_+^n :=  \lbrace x \in \mathbb{R}^n\ \|\ x \geq 0 \rbrace$.


### Second order cone
The *second-order cone*: $\mathcal{Q}_n := \lbrace(u,v) \in \mathbb{R}\times\mathbb{R}^{n-1}\ |\ \|v\|_2 \leq u\rbrace$

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.liquid loading="eager" path="assets/img/posts/fela_socp.png" title="example image" class="img-fluid rounded z-depth-1" %}
    </div>
</div>


**The Mohr-Coulomb yield surface is a second-order cone.**


From earlier the Mohr-Coulomb yield surface was described by

$$
\underbrace{\sqrt{(\sigma_{x}^i - \sigma_y^i)^2 + (2\tau_{xy}^i)^2}}_{\|v\|_2} \leq \underbrace{-\sin(\phi)(\sigma_x^i + \sigma_y^i) + 2c\cos(\phi)}_{u}.
$$

We rewrite this as a second-order conic constraint as

$$
    \begin{bmatrix}
        u \\ v_1 \\ v_2
    \end{bmatrix}
    =   
    \begin{bmatrix}
        -\sin(\phi) & 0 & -\sin(\phi)\\ 1 & 0 & -1 \\ 0 & 2 & 0
    \end{bmatrix}
    \begin{bmatrix}
        \sigma_x^i \\ \tau_{xy}^i \\ \sigma_y^i
    \end{bmatrix}
    + 
    \begin{bmatrix}
        2c\cos(\phi) \\0 \\ 0
    \end{bmatrix}
    \in \mathcal{Q}_3
$$


*Note: Many other material models exist. Interestingly, most of them can be described using cones (semidefinite, power, and exponential cones).*



$$
\begin{aligned}
    \text{maximize}\quad    & \lambda\\
    \text{subject to}\quad  & \mathbf{B}^\top\sigma^V = \lambda\mathbf{P}\\
    \forall i \in 1,\dots,n_\text{nodes} \quad &
    \sqrt{(\sigma_{x}^i - \sigma_y^i)^2 + (2\tau_{xy}^i)^2} \leq -(\sigma_x^i + \sigma_y^i)\sin(\phi) + 2c\cos(\phi)
\end{aligned}
$$

$$
\begin{aligned}
    \text{maximize}\quad    & \lambda\\
    \text{subject to}\quad  & \mathbf{B}^\top\sigma^V = \lambda\mathbf{P}\\
    \forall i \in 1,\dots,n_\text{nodes} \quad &
    \begin{bmatrix}
        -\sin(\phi) & 0 & -\sin(\phi)\\ 1 & 0 & -1 \\ 0 & 2 & 0
    \end{bmatrix}
    \sigma^V_i
    + 
    \begin{bmatrix}
        2c\cos(\phi) \\0 \\ 0
    \end{bmatrix}
    \in \mathcal{Q}_3
\end{aligned},
$$


### Example: Disk
The example is a two-disk with a force applied from the inside. The outer disk is fixed. The goal is to find the maximum pressure $p^\ast$ that can be applied before plastic deformations occur. The problem was studied in <d-cite key="makrodimopoulos2006a"></d-cite>. A visual representation of the problem can see below

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.liquid loading="eager" path="assets/img/posts/fela_disk.png" title="example image" class="img-fluid rounded z-depth-1" %}
    </div>
</div>

The mesh of the domain can be created using Gmsh. The following code creates a mesh with a given number of refinements and polynomial order of the elements.
```julia
function create_disk(refinements;order=1,a=1.0,R=3.0)
    gmsh.initialize()
    gmsh.model.occ.addDisk(0.0,0.0,0.0,a,a,1)
    gmsh.model.occ.addDisk(0.0,0.0,0.0,R,R,2)
    gmsh.model.occ.cut([(2,2)],[(2,1)])
    gmsh.model.occ.synchronize()
    gmsh.model.mesh.generate(2)
    # Refinements for convergence study
    for _ in 1:refinements
        gmsh.model.mesh.refine()
    end
    gmsh.model.mesh.setOrder(order)
    nodes = tonodes()
    elements, _ = toelements(2)
    gmsh.finalize()
    grid = Grid(elements, nodes)
    return grid
end
FerriteViz.wireframe(grid)
```

The theoretical solution to the problem is given by

$$
    p^\ast = c \cot\left[\left(\frac{a}{b}^{(\zeta-1)/\zeta} -1\right)\right] \quad \text{where} \quad \zeta = \tan^2\left(\frac{\pi}{4} + \frac{\phi}{2}\right).
$$

We set $c=1$ and $\phi = 30^\circ$.

We can now solve the problem using the following code
```julia
model = Model(Clarabel.Optimizer)
@variable(model, lambda)               
@variable(model, s[1:ndofs_s]) # \sigma^V
@objective(model, MAX_SENSE, lambda)         
@constraint(model, Bt*s == p*lambda) # Equilibrium equation
# Satisfy the Mohr-Coulomb criterion
A = [-sind(30) 0 -sind(30); 1 0 -1; 0 2 0]
b = [2*cosd(30); 0; 0]
for i in 1:(div(n_func_s*getncells(grid),3))
    idx = (3(i-1)+1):3i
    @constraint(model, A*s[idx] + b in SecondOrderCone())
end
optimize!(model)
```

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.liquid loading="eager" path="assets/img/posts/fela_relerr.png" title="example image" class="img-fluid rounded z-depth-1" %}
    </div>
</div>
